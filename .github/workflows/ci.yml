name: CI

on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:

concurrency:
  group: ci-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  quality-and-unit-tests:
    uses: ./.github/workflows/_reusable-gradle-checks.yml
    with:
      job_name: Quality + Unit Tests
      gradle_command: ktlintCheck test
      timeout_minutes: 25

  kafka-integration-tests:
    uses: ./.github/workflows/_reusable-gradle-checks.yml
    with:
      job_name: Kafka Integration Tests
      gradle_command: :core-kafka:integrationTest
      timeout_minutes: 25
      verify_docker: true
      assert_integration_reports: true
